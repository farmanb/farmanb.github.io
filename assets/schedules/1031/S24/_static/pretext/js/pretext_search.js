function doSearch(e="A"){var t;t="A"==e?document.getElementById("ptxsearch").value:document.getElementById("ptxsearchB").value,localStorage.setItem("last-search-terms",JSON.stringify({terms:t,time:Date.now()}));let l=document.getElementById("searchresults");l.innerHTML="";var s=t;"B"==e?document.getElementById("ptxsearch").value=s:s=t;let n=[];""!=(s=s.toLowerCase().trim())&&(n=ptx_lunr_idx.query(e=>{for(let t of s.split(" "))e.term(t,{fields:["title"],boost:20}),e.term(t,{wildcard:lunr.Query.wildcard.TRAILING,fields:["title"],boost:10}),e.term(t,{fields:["body"],boost:5}),e.term(t,{wildcard:lunr.Query.wildcard.TRAILING,fields:["body"]})})),snum=0;for(let e of ptx_lunr_docs)e.snum=snum,snum+=1;const r=100;let a=n.length>r?n.length-r:0;n.slice(0,r),augmentResults(n,ptx_lunr_docs),n.sort(comparePosition),addResultToPage(t,n,ptx_lunr_docs,a,l),MathJax.typeset()}function findEntry(e,t){for(const l of t)if(l.id===e)return l;return e}function augmentResults(e,t){for(let l of e){let e=findEntry(l.ref,t);l.number=e.number,l.type=e.type,l.title=e.title,l.url=e.url,l.level=e.level,l.snum=e.snum,l.score=parseFloat(l.score);const s=[3,2,1.5];l.level<2&&(l.score*=s[l.level]),l.body="";const n=30;let r=!1;for(const t in l.matchData.metadata)if(l.matchData.metadata[t].title){if(!r){if(!l.matchData.metadata[t].title.position)continue;let e=l.matchData.metadata[t].title.position[0];const s=e[0],n=e[0]+e[1];l.title=l.title.substring(0,n)+"</span>"+l.title.substring(n),l.title=l.title.substring(0,s)+'<span class="search-result-clip-highlight">'+l.title.substring(s),r=!0}}else if(l.matchData.metadata[t].body){if(!l.matchData.metadata[t].body.position)continue;const s=e.body;let r=l.matchData.metadata[t].body.position[0];const a=r[0]-n,o=r[0]+r[1]+n,d=r[0],c=r[0]+r[1];let i=(a>0?"...":"")+s.substring(a,d);i+='<span class="search-result-clip-highlight">'+s.substring(d,c)+"</span>",i+=s.substring(c,o)+(o<s.length?"...":"")+"<br/>",l.body+=i}}}function rearrangedArray(e){let t=[],l=1;for(;e.length>0&&l<500;){++l;let s=maxLocation(e),n=1;for(;"2"==e[s].level;)--s;for(;s+n<e.length&&"2"==e[s+n].level;)++n;t.push(...e.splice(s,n))}return t}function maxLocation(e){let t=0,l=-1;for(let s=0;s<e.length;++s)e[s].score>l&&(t=s,l=e[s].score);return t}function comparePosition(e,t){return e.snum<t.snum?-1:e.snum>t.snum?1:0}function compareScoreDesc(e,t){return e.score<t.score?1:e.score>t.score?-1:0}function addResultToPage(e,t,l,s,n){document.getElementById("searchempty")&&(document.getElementById("searchempty").style.display="none");let r=t.length;if(0==r){if(document.getElementById("searchempty"))document.getElementById("searchempty").style.display="block";else{let e=document.createElement("div");e.classList.add("noresults"),search_no_results_string="No results were found",e.innerHTML=search_no_results_string+".",n.appendChild(e)}return void(document.getElementById("searchresultsplaceholder").style.display=null)}let a=t.map(function(e){return e.score});a.sort((e,t)=>e-t),a.reverse();let o=a[Math.floor(.2*r)],d=a[Math.floor(.4*r)],c=a[Math.floor(.75*r)];"reference"==ptx_lunr_search_style&&(t=rearrangedArray(t));let i="1",u=i,m=n;for(const e of t){let t=document.createElement("a");if(e.score>=o?t.classList.add("high_result"):e.score>=d?t.classList.add("medium_result"):e.score>=c?t.classList.add("low_result"):t.classList.add("no_result"),u=e.level,u>i){i=u;let e=document.createElement("ul");e.classList.add("detailed_result"),n.appendChild(e),n=e}else u<i&&(n=m,i=u);t.href=`${e.url}`,t.innerHTML=`${e.type} ${e.number} ${e.title}`;let l=document.createElement("div");l.classList.add("search-result-clip"),l.innerHTML=`${e.body}`;let s=document.createElement("li");s.classList.add("search-result-bullet"),s.appendChild(t),s.appendChild(l);let r=document.createElement("text");r.classList.add("search-result-score"),r.innerHTML=`  (${e.score.toFixed(2)})`,s.appendChild(r),n.appendChild(s)}document.getElementById("searchresultsplaceholder").style.display=null,MathJax.typesetPromise()}function showHelp(){"none"==document.getElementById("helpme").style.display?(document.getElementById("helpme").style.display="block",document.getElementById("helpbutt").innerHTML="Hide Help"):(document.getElementById("helpme").style.display="none",document.getElementById("helpbutt").innerHTML="Show Help")}window.addEventListener("load",function(){document.getElementById("searchbutton").addEventListener("click",()=>{document.getElementById("searchresultsplaceholder").style.display=null;let e=document.getElementById("ptxsearch");e.value=JSON.parse(localStorage.getItem("last-search-terms")).terms,e.select(),doSearch()}),document.getElementById("ptxsearch").addEventListener("input",()=>{doSearch()}),document.getElementById("closesearchresults").addEventListener("click",()=>{document.getElementById("searchresultsplaceholder").style.display="none",document.getElementById("searchbutton").focus()})});