function fontcss(e){for(var t=Object.keys(e),n="",s=0;s<t.length;++s)this_key=t[s],document.getElementById("the"+this_key).innerHTML=e[this_key][0],"size"==this_key?n+="font-size: "+e[this_key][0].toString()+"pt; ":"height"==this_key?n+="line-height: "+(e[this_key][0]/100).toString()+"; ":"lspace"==this_key?n+="letter-spacing: "+(e[this_key][0]/200).toString()+"rem; ":"wspace"==this_key&&(n+="word-spacing: "+(e[this_key][0]/50).toString()+"rem; ");n+="font-variation-settings: ";for(s=0;s<t.length;++s)this_key=t[s],"wdth"==this_key?n+="'wdth' "+e[this_key][0].toString()+",":"wght"==this_key&&(n+="'wght' "+e[this_key][0].toString()+",");return n=n.slice(0,-1),n+=";"}function choice_options(e){val_dict=prefs_menu_vals[e];var t=Object.keys(val_dict);t.sort();for(var n="",s=0;s<t.length;++s)this_key=t[s],n+='<li id="'+this_key+'">',n+=val_dict[this_key],n+="</li>";return n}function randomstring(e){return e||(e=10),"tMP"+(Math.random()+1).toString(36).substring(2,e)}function removeItemFromList(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e}function textNodesUnder(e){var t=[];for(e=e.firstChild;e;e=e.nextSibling)if(3==e.nodeType)t.push([3,e]);else if(1==e.nodeType){t.push([1,e]);var n=e.cloneNode().outerHTML;[thisopen,thisclose]=n.split("><"),thisopen+=">",thisclose+="<",thisinsides=textNodesUnder(e.cloneNode().innerHTML);for(var s=0;s<thisinsides.length;++s);}return t}function wordsAllWrapped(e){for(var t=textNodesUnder(e),n=0;n<t.length;++n){var s=t[n],i=s[0],o=s[1];if(3==i){for(var l=o.nodeValue.split(/(\s+)/),a="",r=0;r<l.length;++r)a+='<span class="oneword">'+l[r]+"</span>";var c=document.createElement("div");c.setAttribute("class","wastext"),c.innerHTML=a,o.replaceWith(c),c.outerHTML=c.innerHTML}else if(1==i)if(o.classList.contains("process-math")||o.classList.contains("autopermalink")||o.classList.contains("latex-logo")||o.classList.contains("heading")||["A","CODE","PRE"].includes(o.tagName)){var d=document.createElement("span");d.setAttribute("class","oneword"),o.parentNode.insertBefore(d,o),d.appendChild(o)}else wordsAllWrapped(o)}}function linesAllWrapped(){for(var e=document.querySelectorAll("SECTION .para:not(.logical)"),t=0;t<e.length;++t){testNode=e[t],wordsAllWrapped(testNode);for(var n=document.querySelectorAll(".oneword, .oneelement"),s=[],i="",o=n[0].getBoundingClientRect().bottom,l=0,a=0;a<n.length;++a){var r=n[a],c=r.parentElement;if(r.classList.contains("oneword"))if(this_height=r.getBoundingClientRect().bottom,Math.abs(this_height-o)<10&&a>0)if(c==testNode&&0==l)s.push(r.innerHTML);else{if(0==l){var d=c.classList;s.push("<"+c.tagName+' class="'+d[0]+'">'),s.push(r.innerHTML),l+=1}else s.push(r.innerHTML);null==r.nextElementSibling&&(s.push("</"+c.tagName+">"),(l-=1)>0&&null==r.parentElement.nextElementSibling&&(s.push("</"+c.parentElement.tagName+">"),l-=1))}else{html_line_contents="";for(var g=0;g<s.length;++g)html_line_contents+=s[g];l>0&&(html_line_contents+="</"+c.tagName+">"),l>1&&(html_line_contents+="</"+c.parentElement.tagName+">"),i+='<div class="onelineX">'+html_line_contents+"</div>",o=this_height,s=[r.innerHTML],l>0&&s.unshift("<"+c.tagName+' class="'+c.classList[0]+'">'),l>1&&s.unshift("<"+c.tagName+' class="'+c.parentElement.classList[0]+'">')}else s.push(r.outerHTML)}if(s.length>0){html_line_contents="";for(g=0;g<s.length;++g)html_line_contents+=s[g];i+='<div class="onelineX">'+html_line_contents+"</div>"}testNode.innerHTML=i}}function nextsibligntabbable(e,t){var n=e.nextElementSibling;for("previous"==t&&(n=e.previousElementSibling);n;){if(n.hasAttribute("tabindex"))return n;n="next"==t?n.nextElementSibling:n.previousElementSibling}}function logKeyDown(e){if("ShiftLeft"!=e.code&&"ShiftRight"!=e.code&&"Shift"!=e.code){prev_prev_char=prev_char,prev_char=this_char,this_char=e,debugLog("logKey",e,"XXX",e.code);var t=document.activeElement;if(debugLog("input_region",t),"user-preferences-button"==t.id)"Enter"==e.code?document.getElementById("preferences_menu_holder").classList.toggle("hidden"):"Tab"==e.code&&(e.preventDefault(),document.getElementById("preferences_menu_holder").firstElementChild.firstElementChild.focus());else if(t.hasAttribute("data-env")){var n=t.getElementsByTagName("ol")[0];if("Enter"==e.code||"ArrowRight"==e.code)n.classList.toggle("hidden"),t.classList.toggle("selected"),t.parentElement.classList.toggle("active");else if("Tab"==e.code&&e.shiftKey)e.preventDefault(),t.classList.contains("selected")?(n.classList.loggle("hidden"),t.classList.loggle("selected")):(previous_sibling=nextsibligntabbable(t,"previous"),previous_sibling?previous_sibling.focus():(document.getElementById("preferences_menu_holder").classList.toggle("hidden"),document.getElementById("user-preferences-button").focus()));else if("Tab"==e.code)if(e.preventDefault(),t.classList.contains("selected")){var s=n.firstElementChild;s.hasAttribute("tabindex")?s.focus():nextsibligntabbable(s,"next").focus()}else next_sibling=nextsibligntabbable(t,"next"),next_sibling?next_sibling.focus():(document.getElementById("preferences_menu_holder").classList.toggle("hidden"),document.getElementById("user-preferences-button").focus())}else if(t.hasAttribute("data-val"))if("Enter"==e.code||"ArrowRight"==e.code){var o=t.getAttribute("data-val"),l=t.getAttribute("data-change");if(t.parentElement.classList.contains("fonts")){font_vals[o][0]+=parseFloat(l),font_vals[o][0]<font_vals[o][1]?font_vals[o][0]=font_vals[o][1]:font_vals[o][0]>font_vals[o][2]&&(font_vals[o][0]=font_vals[o][2]);var a=fontcss(font_vals),r=document.getElementsByClassName("para");for(i=0;i<r.length;i++)r[i].setAttribute("style",a)}else if(t.parentElement.classList.contains("fontfamily")){document.body.setAttribute("data-font",l);var c=document.getElementsByClassName("ffcheck");for(i=0;i<c.length;i++)c[i].innerHTML="";document.getElementById("the"+l).innerHTML="\u2714\ufe0f"}else if(t.parentElement.classList.contains("avatar")){c=document.getElementsByClassName("avatarcheck");for(i=0;i<c.length;i++)c[i].innerHTML="";document.getElementById("theavatarbutton").innerHTML=o,document.getElementById("the"+o).innerHTML="\u2714\ufe0f"}else if(t.parentElement.classList.contains("atmosphere")){document.body.setAttribute("data-atmosphere",o);c=document.getElementsByClassName("atmospherecheck");for(i=0;i<c.length;i++)c[i].innerHTML="";document.getElementById("the"+o).innerHTML="\u2714\ufe0f"}else if(t.parentElement.classList.contains("ruler"))if(["mouse","arrow","eye"].includes(o)){document.body.setAttribute("data-motion",o);c=document.getElementsByClassName("motioncheck");for(i=0;i<c.length;i++)c[i].innerHTML="";document.getElementById("the"+o).innerHTML="\u2714\ufe0f"}else{document.body.hasAttribute("data-ruler")||linesAllWrapped(),document.body.setAttribute("data-ruler",o);c=document.getElementsByClassName("rulercheck");for(i=0;i<c.length;i++)c[i].innerHTML="";document.getElementById("the"+o).innerHTML="\u2714\ufe0f"}}else"Tab"==e.code&&e.shiftKey?(e.preventDefault(),previous_sibling=nextsibligntabbable(t,"previous"),previous_sibling?previous_sibling.focus():(t.parentElement.parentElement.parentElement.classList.toggle("active"),t.parentElement.parentElement.classList.toggle("selected"),t.parentElement.parentElement.focus(),t.parentElement.classList.toggle("hidden"))):"Tab"==e.code&&(e.preventDefault(),next_sibling=nextsibligntabbable(t,"next"),next_sibling?next_sibling.focus():(t.parentElement.parentElement.parentElement.classList.toggle("active"),t.parentElement.parentElement.classList.toggle("selected"),t.parentElement.parentElement.focus(),t.parentElement.classList.toggle("hidden")))}}editorLog=console.log,debugLog=function(){},parseLog=console.log,errorLog=console.log,editing_mode=0,current_page=location.host+location.pathname,debugLog("current_page",current_page),chosen_edit_option_key="edit_option".concat(current_page),chosen_edit_option="PLACEHOLDER",debugLog("chosen_edit_option",chosen_edit_option,"chosen_edit_option",chosen_edit_option>0);var font_families={RS:"'Roboto Serif', serif;",OS:"'Open Sans', sans-serif;"},font_vals={size:[12,8,20],height:[135,80,200],wspace:[0,-10,20],lspace:[0,-20,20],wdth:[100,50,150],wght:[400,100,1e3]};this_char="",prev_char="",prev_prev_char="",this_focused_element="",prev_focused_element="",prev_prev_focused_element="";var menu_neutral_background="#ddb",menu_active_background="#fdd",recent_editing_actions=[],ongoing_editing_actions=[],old_content={},keyletters=["KeyA","KeyB","KeyC","KeyD","KeyE","KeyF","KeyG","KeyH","KeyI","KeyJ","KeyK","KeyL","KeyM","KeyN","KeyO","KeyP","KeyQ","KeyR","KeyS","KeyT","KeyU","KeyV","KeyW","KeyX","KeyY","KeyZ"],movement_location_options=[],movement_location=0,first_move=!0;Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t,function(e,t){return t.toFixed?Number(t.toFixed(3)):t}))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)},editorLog("adding tab listener"),document.addEventListener("keydown",logKeyDown);