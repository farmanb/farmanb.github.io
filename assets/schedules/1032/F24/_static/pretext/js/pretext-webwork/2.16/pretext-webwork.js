function handleWW(e,t){const n=document.getElementById(e),s=n.dataset.domain,o=n.dataset.problemsource,r=n.dataset.sourcefilepath,a=n.dataset.courseid,c=n.dataset.userid,l=n.dataset.coursepassword,i=n.dataset.localizeCorrect?n.dataset.localizeCorrect:"Correct",d=n.dataset.localizeIncorrect?n.dataset.localizeIncorrect:"Incorrect",u=n.dataset.localizeCheckResponses?n.dataset.localizeCheckResponses:"Check Responses",p=n.dataset.localizeRandomize?n.dataset.localizeRandomize:"Randomize",m=n.dataset.localizeReset?n.dataset.localizeReset:"Reset",h=document.getElementById(e+"-button");t?"randomize"==t&&(n.dataset.current_seed=Number(n.dataset.current_seed)+100):n.dataset.current_seed=n.dataset.seed;let b=document.createElement("div");b.style.position="absolute",b.style.left=0,b.style.top=0,b.style.backgroundColor="rgba(0.2, 0.2, 0.2, 0.4)",b.style.color="white",b.style.width="100%",b.style.height="100%",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.tabIndex=-1;const f=document.createElement("span");let y;if(f.textContent="Loading",f.style.fontSize="2rem",b.appendChild(f),n.appendChild(b),b.focus(),t||(n.dataset.hasHint=n.getElementsByClassName("hint").length>0,n.dataset.hasSolution=n.getElementsByClassName("solution").length>0,n.dataset.hasAnswer=n.getElementsByClassName("answer").length>0,n.dataset.hintLabelText="true"==n.dataset.hasHint?n.querySelectorAll(".hint-knowl span.type")[0].textContent:"Hint",n.dataset.solutionLabelText="true"==n.dataset.hasSolution?n.querySelectorAll(".solution-knowl span.type")[0].textContent:"Solution",n.tabIndex=-1),"check"==t){const t=n.querySelector(".problem-iframe"),o=new FormData(t.contentDocument.getElementById(e+"-form")),r=new URLSearchParams(o);y=new URL(s+"/webwork2/html2xml?"+r.toString()),y.searchParams.append("answersSubmitted","1"),y.searchParams.append("WWsubmit","1")}else y=new URL(s+"/webwork2/html2xml"),y.searchParams.append("problemSeed",n.dataset.current_seed),o?y.searchParams.append("problemSource",o):r&&y.searchParams.append("sourceFilePath",r),y.searchParams.append("answersSubmitted","0"),y.searchParams.append("displayMode","MathJax"),y.searchParams.append("courseID",a),y.searchParams.append("userID",c),y.searchParams.append("course_password",l),y.searchParams.append("outputformat","raw"),y.searchParams.append("showSolutions","true"==n.dataset.hasSolution?"1":"0"),y.searchParams.append("showHints","true"==n.dataset.hasHint?"1":"0"),y.searchParams.append("problemUUID",e);$.getJSON(y.toString(),f=>{const y=document.createElement("form");y.id=e+"-form";const w=document.createElement("div");w.id=e+"-body",w.classList.add("exercise","exercise-like"),w.lang=f.lang,w.dir=f.dir,w.innerHTML=f.rh_result.text;for(const e of["h6","h5","h4","h3","h2","h1"]){const t=w.getElementsByTagName(e);for(heading of t){const e=document.createElement("h6");e.innerHTML=heading.innerHTML,cloneAttributes(e,heading),e.classList.add("webwork-part"),heading.replaceWith(e)}}adjustSrcHrefs(w,s),translateHintSol(e,w,s,"true"==n.dataset.hasHint,"true"==n.dataset.hasSolution,n.dataset.hintLabelText,n.dataset.solutionLabelText),y.appendChild(w);const g={problemSeed:f.inputs_ref.problemSeed,problemUUID:f.inputs_ref.problemUUID,psvn:f.inputs_ref.psvn,courseName:a,courseID:a,userID:c,course_password:l,displayMode:"MathJax",session_key:f.rh_result.session_key,outputformat:"raw",language:f.formLanguage,showSummary:f.showSummary,showSolutions:"true"==n.dataset.hasSolution?"1":"0",showHints:"true"==n.dataset.hasHint?"1":"0",forcePortNumber:f.forcePortNumber};r?g.sourceFilePath=r:o&&(g.problemSource=o);for(const e of Object.keys(g)){const t=document.createElement("input");t.type="hidden",t.name=e,t.value=g[e],y.appendChild(t)}const x={};Object.keys(f.rh_result.answers).forEach(function(e){x[e]={}},f.rh_result.answers),"true"==n.dataset.hasAnswer&&Object.keys(f.rh_result.answers).forEach(function(e){x[e]={correct_ans:this[e].correct_ans,correct_ans_latex_string:this[e].correct_ans_latex_string,correct_choice:this[e].correct_choice}},f.rh_result.answers);let _=n.querySelector(".problem-buttons.webwork");if(_){if("true"==n.dataset.hasAnswer){const t=_.querySelector(".show-correct"),n=t.cloneNode(!0);n.addEventListener("click",()=>WWshowCorrect(e,x)),t.replaceWith(n)}}else{n.querySelector(".problem-buttons").classList.add("hidden-content"),null!=h&&h.classList.add("hidden-content"),_=document.createElement("div"),_.classList.add("problem-buttons","webwork"),null!=h?h.after(_):n.prepend(_);const t=document.createElement("button");t.type="button",t.id=e+"-check",t.style.marginRight="0.25rem",t.classList.add("webwork-button");const s=w.querySelectorAll("input:not([type=hidden])").length+w.querySelectorAll("select:not([type=hidden])").length;if(t.textContent=u,t.addEventListener("click",()=>handleWW(e,"check")),_.appendChild(t),"true"==n.dataset.hasAnswer){const t=document.createElement("button");t.classList.add("show-correct","webwork-button"),t.type="button",t.style.marginRight="0.25rem",t.textContent=s>1?"Show Correct Answers":"Show Correct Answer",t.addEventListener("click",()=>WWshowCorrect(e,x)),_.appendChild(t)}const o=document.createElement("button");o.type="button",o.classList.add("webwork-button"),o.style.marginRight="0.25rem",o.textContent=p,o.addEventListener("click",()=>handleWW(e,"randomize")),_.appendChild(o);const r=document.createElement("button");r.type="button",r.classList.add("webwork-button"),r.textContent=m,r.addEventListener("click",()=>resetWW(e)),_.appendChild(r)}if("check"==t){$("body").trigger("runestone_ww_check",f);const t=w.querySelectorAll("input:not([type=hidden])");for(const n of t){const t=n.name;if("text"==n.type&&x[t]){const s=f.rh_result.answers[t].score;let o="";if(1==s)o=`<span class="correct">${i}!</span>`;else if(s>0&&s<1)o=`<span class="partly-correct">${Math.round(100*s)}% ${i}.</span>`;else{if(""==f.rh_result.answers[t].student_ans)continue;0==s&&(o=`<span class="incorrect">${d}.</span>`)}n.after(createFeedbackButton(`${e}-${t}`,o,f.rh_result.answers[t].ans_message))}if("radio"==n.type&&x[t]&&n.value==f.rh_result.answers[t].student_value){const s=createFeedbackButton(`${e}-${t}`,f.rh_result.answers[t].student_value==f.rh_result.answers[t].correct_choice?`<span class="correct">${i}!</span>`:`<span class="incorrect">${d}.</span>`);s.style.marginRight="0.25rem",n.after(s)}}const n=w.querySelectorAll("input[type=hidden]");for(const t of n){const n=t.name;if(!t.nextElementSibling)continue;const s=t.nextElementSibling.nextElementSibling;if(s&&x[n]&&s.classList.contains("graphtool-container")){s.style.position="relative";const t=f.rh_result.answers[n].score;let o="";if(1==t)o=`<span class="correct">${i}!</span>`;else if(t>0&&t<1)o=`<span class="partly-correct">${Math.round(100*t)}% ${i}.</span>`;else{if(""==f.rh_result.answers[n].student_ans)continue;0==t&&(o=`<span class="incorrect">${d}.</span>`)}const r=createFeedbackButton(`${e}-${n}`,o,f.rh_result.answers[n].ans_message);r.style.position="absolute",r.style.left="100%",r.style.top=0,r.style.marginLeft="0.5rem",r.dataset.container="body",s.appendChild(r)}}const s=w.querySelectorAll("select:not([type=hidden])");for(const t of s){const n=t.name,s=createFeedbackButton(`${e}-${n}`,1==f.rh_result.answers[n].score?`<span class="correct">${i}!</span>`:`<span class="incorrect">${d}.</span>`);s.style.marginRight="0.25rem",s.style.marginLeft="0.5rem",t.after(s)}}let k='<!DOCTYPE html><head><script src="'+s+"/webwork2_files/node_modules/jquery/dist/jquery.min.js\"></script><script>window.MathJax = {\n              tex: {\n                inlineMath: [['\\\\(','\\\\)']],\n                tags: \"none\",\n                useLabelIds: true,\n                tagSide: \"right\",\n                tagIndent: \".8em\",\n                packages: {'[+]': ['base', 'extpfeil', 'ams', 'amscd', 'newcommand', 'knowl']}\n              },\n              options: {\n                ignoreHtmlClass: \"tex2jax_ignore\",\n                processHtmlClass: \"has_am\",\n                renderActions: {\n                    findScript: [10, function (doc) {\n                        document.querySelectorAll('script[type^=\"math/tex\"]').forEach(function(node) {\n                            const display = !!node.type.match(/; *mode=display/);\n                            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);\n                            const text = document.createTextNode('');\n                            node.parentNode.replaceChild(text, node);\n                            math.start = {node: text, delim: '', n: 0};\n                            math.end = {node: text, delim: '', n: 0};\n                            doc.math.push(math);\n                        });\n                    }, '']\n                },\n              },\n              chtml: {\n                scale: 0.88,\n                mtextInheritFont: true\n              },\n              loader: {\n                load: ['input/asciimath', '[tex]/extpfeil', '[tex]/amscd', '[tex]/newcommand', '[pretext]/mathjaxknowl3.js'],\n                paths: {pretext: \"https://pretextbook.org/js/lib\"},\n              },\n            };\n            </script><script src=\""+s+'/webwork2_files/mathjax/es5/tex-chtml.js" id="MathJax-script" defer></script><script src="https://pretextbook.org/js/lib/knowl.js" defer></script><link rel="stylesheet" href="'+s+'/webwork2_files/js/vendor/bootstrap/css/bootstrap.css"/><link rel="stylesheet" href="'+s+'/webwork2_files/themes/math4/math4.css"/><script src="'+s+'/webwork2_files/js/vendor/bootstrap/js/bootstrap.js" id="MathJax-script" defer></script>';const E=[],v=[];f.rh_result.flags.extra_css_files?f.rh_result.flags.extra_css_files.unshift(...E):f.rh_result.flags.extra_css_files=E;for(const e of f.rh_result.flags.extra_css_files)k+='<link rel="stylesheet" href="'+("1"!==e.external?s+"/webwork2_files/":"")+e.file+'"/>';f.rh_result.flags.extra_js_files?f.rh_result.flags.extra_js_files.unshift(...v):f.rh_result.flags.extra_js_files=v;for(const e of f.rh_result.flags.extra_js_files)k+='<script src="'+("1"!==e.external?s+"/webwork2_files/":"")+e.file+'" '+Object.keys(e.attributes||{}).reduce((t,n)=>t+=n+'="'+e.attributes[n]+'" ',"")+"></script>";let S;k+='<link rel="stylesheet" href="https://pretextbook.org/css/0.31/pretext_add_on.css"/><link rel="stylesheet" href="https://pretextbook.org/css/0.31/knowls_default.css"/><script src="'+s+'/webwork2_files/node_modules/iframe-resizer/js/iframeResizer.contentWindow.min.js"></script><style>\n            html { overflow-y: hidden; }\n            html body { background:unset; margin: 0; }\n            body { font-size: initial; line-height: initial; }\n            .hidden-content { display: none; }\n            input[type="text"], input[type="radio"], label, select {\n                height: auto;\n                width: auto;\n                max-width: unset;\n                margin: 0;\n                font-size: initial;\n                font-family: sans-serif;\n                line-height: initial;\n            }\n            input[type="text"] {\n                padding: 1px;\n                padding-inline: 2px;\n                border-width: 1px;\n                border-style: inset;\n                border-color: rgb(133, 133, 133);\n                border-radius: 0;\n                box-shadow: unset;\n                transition: none;\n            }\n            input[type="text"]:focus, input[type="text"]:active {\n                box-shadow: unset;\n                border-width: 1px;\n                border-style: inset;\n                border-radius: 4px;\n                border-color: rgb(133, 133, 133);\n                outline: auto;\n            }\n            input[type="radio"] {\n                box-sizing: border-box;\n                margin-block: 3px 0;\n                margin-inline: 5px 3px;\n                vertical-align: unset;\n            }\n            label {\n                display: inline-block;\n            }\n            select {\n            \tmargin: 0;\n            \tborder-width: 1px;\n            \tborder-style: inset;\n            \tdisplay: inline-block;\n            \tpadding-block: 1px;\n            \tvertical-align: baseline;\n                background-color: unset;\n                padding-inline: 0;\n            }\n            .popover-title, .popover-content {\n                text-align: center;\n            }\n            .popover-title.correct {\n                background-color: #8F8;\n            }\n            .accordion-body.expanded {\n                overflow-y: visible;\n                overflow-x: clip;\n            }\n\t\t\t.graphtool-answer-container .graphtool-graph {\n\t\t\t\tmargin: 0;\n\t\t\t\twidth: 300px;\n\t\t\t\theight: 300px;\n\t\t\t}\n            div.PGML img.image-view-elt {\n                 max-width:100%;\n            }\n            </style></head><body><main class="pretext-content">'+y.outerHTML+"</main></body></html>",t?S=n.querySelector(".problem-iframe"):(S=document.createElement("iframe"),S.style.width="1px",S.style.minWidth="100%",S.classList.add("problem-iframe"),n.querySelector(".problem-contents").classList.add("hidden-content"),null!=h?h.after(S):n.prepend(S),iFrameResize({checkOrigin:!1,scrolling:"omit",heightCalculationMethod:"min"},S),S.addEventListener("load",()=>{S.contentDocument.getElementById(e+"-form").addEventListener("submit",t=>{handleWW(e,"check"),t.preventDefault()}),S.contentDocument.querySelectorAll(".collapse.in").forEach(e=>e.classList.add("expanded")),S.contentWindow.jQuery(".collapse").on("shown",function(e){e.target==this&&this.classList.add("expanded")}),S.contentWindow.jQuery(".collapse").on("hide",function(e){e.target==this&&this.classList.remove("expanded")}),S.contentDocument.querySelectorAll("button.ww-feedback[data-content]").forEach(e=>{S.contentWindow.jQuery(e).popover("show");const t=S.contentDocument.getElementById(e.id.replace("-feedback-button","-content")),n=t.parentNode.parentNode;n.id=e.id.replace("-feedback-button","-feedback"),e.setAttribute("aria-describedby",n.id),e.previousElementSibling&&e.previousElementSibling.setAttribute("aria-describedby",n.id),n.querySelector(".arrow").remove();const s=n.querySelector(".popover-title");e.dataset.emptyContent&&(s.style.borderBottomWidth=0,t.parentNode.remove()),s.textContent==i+"!"&&s.classList.add("correct")}),S.contentWindow.MathJax.startup.promise.then(()=>S.contentWindow.MathJax.typesetPromise([".popover",".popover-content"]))})),S.srcdoc=k,S.addEventListener("load",()=>{b.remove()},{once:!0}),n.focus()})}function WWshowCorrect(e,t){const n=document.getElementById(e).querySelector(".problem-iframe"),s=n.contentDocument.getElementById(e+"-body");$("body").trigger("runestone_show_correct",{ww_id:e,answers:t});let o=s.querySelectorAll("input:not([type=hidden])");for(const s of o){const o=s.name,r=`${e}-${o}-correct`;if("text"==s.type&&t[o]&&!n.contentDocument.getElementById(r)){const a=n.contentDocument.getElementById(`${e}-${o}-feedback-button`);a&&(a.remove(),n.contentWindow.jQuery(a).popover("hide")),label=n.contentDocument.getElementById(`${r}-label`),label&&(label.parentElement.insertBefore(s,label),label.remove()),s.type="hidden";const c=n.contentDocument.createElement("div");c.innerHTML=t[o].correct_ans,s.value=c.textContent;const l=n.contentDocument.createElement("span");l.id=r,l.appendChild(t[o].correct_ans_latex_string?n.contentDocument.createTextNode("\\("+t[o].correct_ans_latex_string+"\\)"):n.contentDocument.createTextNode(t[o].correct_ans)),s.parentElement.insertBefore(l,s)}if("radio"==s.type&&t[o]){const r=n.contentDocument.getElementById(`${e}-${o}-feedback-button`);r&&(r.remove(),n.contentWindow.jQuery(r).popover("hide")),correct_value=t[o].correct_choice,s.value==correct_value&&(s.checked=!0)}}const r=s.querySelectorAll("input[type=hidden]");for(const s of r){const o=s.name;if(!s.nextElementSibling)continue;const r=s.nextElementSibling.nextElementSibling;if(r&&t[o]&&r.classList.contains("graphtool-container")){const a=n.contentDocument.getElementById(`${e}-${o}-feedback-button`);a&&(a.remove(),n.contentWindow.jQuery(a).popover("hide"));const c=n.contentDocument.createElement("div");s.parentElement.insertBefore(c,r),r.style.display="none",s.value=t[o].correct_ans,n.contentWindow.jQuery(c).html(t[o].correct_ans_latex_string);const l=n.contentDocument.createElement("script");l.textContent=c.querySelector("script").textContent.replace('\nwindow.addEventListener("DOMContentLoaded",',"(").replace(/;\n$/,"();"),n.contentDocument.body.appendChild(l)}}let a=s.querySelectorAll("select:not([type=hidden])");for(const s of a){const o=s.name,r=`${e}-${o}-correct`;if(t[o]&&!n.contentDocument.getElementById(r)){const a=n.contentDocument.getElementById(`${e}-${o}-feedback-button`);a&&(a.remove(),n.contentWindow.jQuery(a).popover("hide")),s.style.display="none",s.value=t[o].correct_ans;const c=n.contentDocument.createElement("span");c.id=r,c.appendChild(t[o].correct_ans_latex_string?n.contentDocument.createTextNode("\\("+t[o].correct_ans_latex_string+"\\)"):n.contentDocument.createTextNode(t[o].correct_ans)),s.parentElement.insertBefore(c,s)}}const c=n.contentDocument.createElement("script");c.textContent="MathJax.startup.promise.then(() => MathJax.typesetPromise([document.body]));",n.contentDocument.body.appendChild(c)}function resetWW(e){const t=document.getElementById(e),n=document.getElementById(e+"-button");t.dataset.current_seed=t.dataset.seed,iframe=t.querySelector(".problem-iframe"),iframe.remove(),t.querySelector(".problem-contents").classList.remove("hidden-content"),t.querySelector(".problem-buttons.webwork").remove(),t.querySelector(".problem-buttons").classList.remove("hidden-content"),null!=n&&n.classList.remove("hidden-content")}function adjustSrcHrefs(e,t){e.querySelectorAll("[href]").forEach(e=>{const n=e.attributes.href.value;"#"===n||n.match(/^[a-z]+:\/\//i)||(e.href=t+"/"+n)}),e.querySelectorAll("[src]").forEach(e=>{e.src=t+"/"+e.attributes.src.value})}function translateHintSol(e,t,n,s,o,r,a){document.getElementById(e);const c=document.evaluate("//p[a/b]",t,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);if(c){let e;for(let t=0;t<c.snapshotLength;t++){const l=c.snapshotItem(t);if(!l)continue;const i=l.textContent.trim().toLowerCase().replace(":","");if("Hint:"!=l.previousElementSibling.textContent.trim()&&"Solution:"!=l.previousElementSibling.textContent.trim()&&(e=document.createElement("div"),e.classList.add("webwork","solutions"),l.parentNode.insertBefore(e,l)),"solution"==i&&!o||"hint"==i&&!s)continue;const d=document.createElement("details");d.classList.add(i),d.classList.add("solution-like"),d.classList.add("born-hidden-knowl");const u=document.createElement("summary"),p=document.createElement("span");p.classList.add("type"),p.innerHTML="hint"==i?r:a,u.appendChild(p),d.appendChild(u);const m=document.createElement("div");m.classList.add(i),m.classList.add("solution-like"),m.innerHTML=l.firstElementChild.dataset.knowlContents,d.appendChild(m),adjustSrcHrefs(m,n),e.appendChild(d)}}for(let e=0;e<c.snapshotLength;e++)c.snapshotItem(e).remove()}function cloneAttributes(e,t){[...t.attributes].forEach(t=>{e.setAttribute(t.nodeName,t.nodeValue)})}function createFeedbackButton(e,t,n){const s=document.createElement("button");s.dataset.title=t,s.dataset.content=`<div id="${e}-content">${n||""}</div>`,n||(s.dataset.emptyContent="1");const o=document.createElement("span");return o.style.fontWeight=1e3,o.textContent="\ud83d\udde9",s.appendChild(o),s.type="button",s.classList.add("ww-feedback"),s.style.borderRadius=0,s.id=`${e}-feedback-button`,s.dataset.html=!0,s.dataset.placement="bottom",s.dataset.trigger="click",s}