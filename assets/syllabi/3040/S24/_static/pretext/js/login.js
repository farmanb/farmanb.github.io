function createCookie(e,t,o){if(o){var n=new Date;n.setTime(n.getTime()+24*o*60*60*1e3);var r="; expires="+n.toGMTString()}else r="";document.cookie=e+"="+t+r+"; path=/; SameSite=None; Secure"}function readCookie(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}function hash_of_string(e){var t=(e=e.toString()).length;t=Math.min(12,t);for(var o=123456,n=[510149,120151,230157,411063,320167,631973,410179,321081,231091,111093,121097,230199],r=0;r<t;++r){var i=e.charCodeAt(r);o+=(i=parseInt(i))*n[r],o%=1e6}return o.toString()}function login_form(e="login"){var t="";"logout"==e?(t+='<form name="logoutform" class="modal-content animate" onSubmit="return removeLogin();" action="">',t+='<div class="container">\n',t+='<button type="submit">Yes, really logout</button>',t+='<div id="dontlogout" class=dontlogout">Stay logged in</div>',t+="</div>\n",t+="</form>\n"):(t+='<form name="loginform" class="modal-content animate" onSubmit="return validateLogin();" action="">',"undefined"!=typeof guest_access&&guest_access&&(t+='<p class="instructions" >You can log in as "guest" with password "guest" for 3 hours of access.</p>'),t+='<div class="container">\n',t+='<label><b>Id</b></label>\n<input type="text" placeholder="Enter Username" name="uname" required>',t+='<label><b>Password</b></label>\n<input type="password" placeholder="Enter Password" name="psw" required>',t+='<button type="submit">Login</button>',t+="</div>\n",t+='<div class="container" style="background-color:#f1f1f1">',t+='<span class="psw">Login trouble? Email <a href="mailto:help@aimath.org">help@aimath.org</a></span>',t+="</div>\n",t+="</form>\n"),theform=document.createElement("div"),theform.id="the"+e+"form",theform.className="modal login",document.body.appendChild(theform),theform.innerHTML=t}function survey_form(){var e="";e+='<div class="modal-content">',e+='<p class="instructions">Can you take a brief survey<br>about your use of this book?</p>',e+='<button class="surveyresponse" id="takesurvey">Yes, I can take the survey<br>(opens new window)</button>',e+='<button class="surveyresponse" id="remindlater">Not now.  Please remind me later.</button>',e+="</div>\n",theform=document.createElement("div"),theform.id="thesurveyform",theform.className="modal survey",document.body.appendChild(theform),theform.innerHTML=e}function loadScript(e){"undefined"==typeof js_version&&(js_version="0.12");var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://pretextbook.org/js/"+js_version+"/"+e+".js";var o=document.getElementsByTagName("script"),n=o[o.length-1];n.parentNode.insertBefore(t,n.nextSibling)}function removeLogin(){eraseCookie("ut_cookie")}function check_role(){if("instructor"==uname)return"instructor";var_role_data={action:"check",user:uname,pw:emanu,type:"instructor",instId:uname};var e="";return $.ajax({url:"https://aimath.org/cgi-bin/u/highlights.py",type:"post",data:JSON.stringify(var_role_data),dataType:"json",async:!1,success:function(t){e=t},error:function(){}}),e}function validateLogin(){var e=!1,t=document.loginform.uname.value;uname=t;var o=document.loginform.psw.value;emanu=o;var n="guest",r="guest",i="editor",a="editor",s="instructor",u="instructor",c=hash_of_string(t),l=hash_of_string(window.location.hostname);"undefined"!=typeof guest_access&&guest_access&&(t==n&&o==r||t==i&&o==a)?(createCookie("ut_cookie",t,.25),e=!0):"undefined"!=typeof guest_access&&guest_access&&t==s&&o==u?(createCookie("ut_cookie",t,.25),e=!0,role="instructor"):o==c?(createCookie("ut_cookie",t,150),e=!0):o==l?(createCookie("ut_cookie",t,.25),e=!0):(alert('Login was unsuccessful, please check id: "'+uname+'".'),e=!1),e&&($("#theloginform").hide(),document.getElementById("loginlogout").innerHTML="logout "+t,"editor"!=uname&&(loadScript("answer"),loadScript("highlight"),"undefined"!=typeof trails&&trails&&loadScript("trails")));var d=check_role();return d&&(role="instructor"),e}Storage.prototype.setObject=function(e,t){this.setItem(e,JSON.stringify(t,function(e,t){return t.toFixed?Number(t.toFixed(3)):t}))},Storage.prototype.getObject=function(e){var t=this.getItem(e);return t&&JSON.parse(t)};var uname="",emanu="",aa_id=readCookie("aa_cookie");if(aa_id)var date,date_now,date_str,date_str_trimmed=(date_str=(date_now=(date=new Date).getTime()).toString()).slice(5,13);else createCookie("aa_cookie",aa_id=date_str_trimmed=(date_str=(date_now=(date=new Date).getTime()).toString()).slice(5,13),150);var ut_id=readCookie("ut_cookie");"instructor"==(uname=ut_id||"")&&(role="instructor");var pageIdentifier="";window.addEventListener("load",function(){if(bodyID=document.getElementsByTagName("body")[0].id,bodyID){var e=document.getElementsByTagName("section")[0].id;e&&(pageIdentifier=bodyID+"___"+e)}if(pageIdentifier){if(ut_id){$("#theloginform").hide();var t=check_role();t&&(role="instructor"),document.getElementById("loginlogout").className="logout",document.getElementById("loginlogout").innerHTML="logout "+ut_id,loadScript("answer"),"editor"!=uname&&loadScript("highlight"),"undefined"!=typeof trails&&trails&&loadScript("trails")}else"undefined"!=typeof login_required&&login_required&&login_form();$("#loginlogout.logout").click(function(){login_form("logout"),$("#dontlogout").click(function(){$("#thelogoutform").remove()})}),$("#loginlogout.login").click(function(){login_form("login")})}});