function escapeHTML(e){return e?(the_ans=e,the_ans=the_ans.replace(/&/g,"&amp;"),the_ans=the_ans.replace(/<([a-zA-Z])/g,"< $1"),the_ans):""}function uNescapeHTML(e){return e?(the_ans=e,the_ans=the_ans.replace(/&lt; /g,"<"),the_ans=the_ans.replace(/&lt;/g,"<"),the_ans=the_ans.replace(/&gt;/g,">"),the_ans=the_ans.replace(/&amp;/g,"&"),the_ans=the_ans.replace(/<([a-zA-Z])/g,"< $1"),the_ans):""}function dollars_to_slashparen(e){return the_ans=e,the_ans=the_ans.replace(/(^|\s|-)\$([^\$\f\r\n]+)\$(\s|\.|,|;|:|\?|!|$)/g,"$1\\($2\\)$3"),the_ans=the_ans.replace(/(^|\s|-)\$([^\$\f\r\n]+)\$(\s|\.|,|;|:|\?|!|-|$)/g,"$1\\($2\\)$3"),the_ans}function make_submit_button(){document.getElementById("rq_submit")||(last_reading_question=reading_questions[reading_questions.length-1],answer_button_holder=document.createElement("div"),answer_button_holder.setAttribute("class","rq_submit_wrapper"),answer_button_holder.innerHTML=rq_submit_button,last_reading_question.insertAdjacentElement("afterend",answer_button_holder))}function save_reading_questions(){rq_data={action:"save",user:uname,pw:emanu,pI:pageIdentifier,type:"readingquestions",rq:JSON.stringify(reading_questions_object)},$.ajax({url:"https://aimath.org/cgi-bin/u/highlights.py",type:"post",data:JSON.stringify(rq_data),dataType:"json",success:function(e){alert(e)},error:function(e){alert("Error\n"+e)}})}var reading_questions=document.querySelectorAll("section.reading-questions article.exercise-like, #boelkins-ACS .main #content > section:first-of-type > section:first-of-type > .project-like li"),reading_answers={};if(reading_questions.length){var reading_questions_object_id=pageIdentifier+"___rq",reading_questions_object=localStorage.getObject(reading_questions_object_id),reading_questions_all_answered=!1,reading_questions_submitted=!1;reading_questions_object||(reading_questions_object={}),Object.keys(reading_questions_object).length>=reading_questions.length&&(reading_questions_all_answered=!0),answer_css=document.createElement("style"),answer_css.type="text/css",answer_css.id="highlight_css",document.head.appendChild(answer_css);var css_for_ans="#rq_submit { background: #FDD; padding: 3px 5px; border-radius: 0.5em}\n";css_for_ans+="#rq_submit.submitted { background: #EFE; color: #BBB}",css_for_ans+=".rq_submit_wrapper { margin-top: 0.5em; float: right}",answer_css.innerHTML=css_for_ans,rq_answer_label="<span",rq_answer_label+=' class="readingquestion_make_answer addcontent',rq_answer_label+=" "+role+'"',rq_answer_label+=">","instructor"==role?rq_answer_label+="Responses&rarr;":rq_answer_label+="Click twice to edit...",rq_answer_label+="</span>";var rq_submit_button="<span";rq_submit_button+=' class="submit"',rq_submit_button+=' id="rq_submit"',rq_submit_button+=">",rq_submit_button+="Submit answers",rq_submit_button+="</span>";for(var j=0;j<reading_questions.length;++j){var reading_question=reading_questions[j],reading_question_id=reading_question.id;rq_answer_id=reading_question_id+"_text";var existing_content=reading_questions_object[rq_answer_id];if(existing_content&&"student"==role){$("#"+reading_question_id).find(".readingquestion_make_answer").addClass("hidecontrols");var this_ques_id_text=reading_question_id+"_text",this_ques_id_controls=reading_question_id+"_controls",answer_div="<div";answer_div+=' id="'+this_ques_id_text+'"',answer_div+=' class="given_answer has_am process-math processme"',answer_div+=">",answer_div+=dollars_to_slashparen(escapeHTML(existing_content))+" ",answer_div+="</div>";var hidden_answer_div="<div";hidden_answer_div+=' id="'+this_ques_id_text+'_hidden"',hidden_answer_div+=' class="tex2jax_ignore asciimath2jax_ignore" style="display: none">',hidden_answer_div+=escapeHTML(existing_content),hidden_answer_div+="</div>";var this_rq_controls='<div id="'+this_ques_id_controls+'" class="input_controls hidecontrols">';this_rq_controls+='<span class="action save_item rq_save">preview</span>',this_rq_controls+='<span class="action amhelp">typing math?</span>',this_rq_controls+="</div>";var this_rq_answer_and_controls=document.createElement("div");this_rq_answer_and_controls.setAttribute("style","width:80%; padding-left:10%; padding-right:10%; margin-top:0.5em;"),this_rq_answer_and_controls.setAttribute("class","rq_answer"),this_rq_answer_and_controls.innerHTML=hidden_answer_div+answer_div+this_rq_controls,$("#"+reading_question_id).append(this_rq_answer_and_controls),mjvers&&mjvers<3?MathJax.Hub.Queue(["Typeset",MathJax.Hub]):mjvers>3&&MathJax.typesetPromise()}else if("instructor"==role||"student"==role){var this_answer_link=document.createElement("div");this_answer_link.innerHTML=rq_answer_label,reading_question.append(this_answer_link)}}function allow_student_answers(){$(".readingquestion_make_answer.student").mousedown(function(){var e=this.parentNode.parentNode.id,t=e+"_text";answer_textarea="<textarea",answer_textarea+=' class="rq_answer_text"',answer_textarea+=' id="'+t+'_input"',answer_textarea+=' rows="3"',answer_textarea+=' style="width:95%; height: 63px;"',answer_textarea+=">",answer_textarea+="</textarea>";var s='<div id="'+(e+"_controls")+'" class="input_controls" style="margin-bottom:-1.9em;">';s+='<span class="action save_item rq_save">preview</span>',s+='<span class="action amhelp">typing math?</span>',s+="</div>";var n=document.createElement("div");n.setAttribute("class","rq_answer editing"),n.setAttribute("style","width:80%; padding-left:10%; padding-right:10%; margin-top:0.5em;"),n.innerHTML=answer_textarea+s,this.parentNode.insertAdjacentElement("afterend",n),this.remove();var a=document.getElementById(t+"_input");a.addEventListener("keypress",function(){a.overflow="scroll",a.overflow="hidden",a.style.height=a.scrollHeight+"px"},!1);var r=t+"_input";$("#"+r).focus(),document.getElementById(r).focus()})}function save_one_reading_question(e){this_ques_id_text=e+"_text";var t=$("#"+this_ques_id_text+"_input"),s=t.val();if(/[^\x00-\x7F]/.test(s)&&(s=s.replace(/[^\x00-\x7F]/g,"XX"),alert("Illegal characters in answer have been replaced by XX")),s=$.trim(s),reading_questions_object[this_ques_id_text]=s,localStorage.setObject(reading_questions_object_id,reading_questions_object),Object.keys(reading_questions_object).length>=reading_questions.length&&"guest"!=uname&&"student"==role&&(reading_questions_all_answered=!0,make_submit_button()),!document.getElementById(e+"_text_hidden")){var n=document.createElement("div");n.setAttribute("id",e+"_text_hidden"),n.setAttribute("class","tex2jax_ignore asciimath2jax_ignore"),n.setAttribute("style","display: none"),document.getElementById(this_ques_id_text+"_input").insertAdjacentElement("beforebegin",n)}document.getElementById(e+"_text_hidden").innerHTML=escapeHTML(s);var a=document.createElement("div");a.setAttribute("id",this_ques_id_text),a.setAttribute("class","given_answer has_am process-math processme"),a.innerHTML=dollars_to_slashparen(escapeHTML(s))+" ",t.replaceWith(a),mjvers&&mjvers<3?MathJax.Hub.Queue(["Typeset",MathJax.Hub]):mjvers>3&&MathJax.typesetPromise(),$(a).parent().addClass("rq_answer"),$("#"+e+"_controls").addClass("hidecontrols")}function edit_one_reading_question(e){var t=e.parentNode.parentNode.id,s=t+"_text",n=e,a=(n.innerHTML,uNescapeHTML(document.getElementById(t+"_text_hidden").innerHTML)),r=document.createElement("textarea");r.setAttribute("id",s+"_input"),r.setAttribute("class","rq_answer_text"),r.setAttribute("rows","3"),r.setAttribute("style","width:95%; height: 44px;"),n.replaceWith(r),$("#"+s+"_input").parent().addClass("editing"),$("#"+t+"_controls").removeClass("hidecontrols"),$("#"+t+"_text_input").val(a),r.style.height=r.scrollHeight+"px",r.addEventListener("keypress",function(){r.style.height=r.scrollHeight+"px"},!1)}allow_student_answers(),$(".readingquestion_make_answer.instructor").mousedown(function(){(jQuery.isEmptyObject(reading_answers)||this.classList.contains("reload"))&&(rq_data={action:"retrieve",instId:uname,pw:emanu,pI:pageIdentifier,type:"readingquestions"},$.ajax({url:"https://aimath.org/cgi-bin/u/highlights.py",type:"post",data:JSON.stringify(rq_data),dataType:"json",async:!1,success:function(e){reading_answers=e},error:function(e){alert("Error\n"+e)}}));var e=this.parentNode.parentNode.id,t="",s=$("section > h2 > .title").html();s=(s=s.replace(/ /g,"%20")).replace(/\?/g,"");for(var n=1+$("#"+e).index(".exercise-like"),a=0;a<reading_answers.length;++a){var r=reading_answers[a],i=r[0],_=JSON.parse(r[1]),o=JSON.parse(r[2]),d=_[e+"_text"];(d=dollars_to_slashparen(escapeHTML(d)))?t+='<div class="one_answer">':(d="no answer submitted",t+='<div class="one_answer noanswer">'),i.indexOf("@")>-1&&(i='<a href="mailto:'+i+"?Subject=RQ"+n+"%20of%20"+s+'">'+i+"</a>"),t+='<div class="s_id">'+i+"</div>",t+='<div class="rq_sub_time">'+o+"</div>",t+='<div class="s_ans has_am process-math processme">'+d+"</div>",t+="</div>\n"}$("#"+e+"_ans").remove();var l=document.createElement("div");l.setAttribute("class","compiled_answers"),l.setAttribute("id",e+"_ans"),l.innerHTML=t,$("#"+e).append(l),this.innerHTML="Reload responses",$(this).addClass("reload"),mjvers&&mjvers<3?MathJax.Hub.Queue(["Typeset",MathJax.Hub]):mjvers>3&&MathJax.typesetPromise()}),$("body").on("click",".given_answer",function(){edit_one_reading_question(this),$(this).attr("z-index","2000")}),$("body").on("mousedown",".rq_save",function(){var e=this.parentNode.parentNode.parentNode.id;document.getElementById(e+"_text_input");save_one_reading_question(e),$(this).removeClass("editing")}),$("body").on("click",".rq_delete",function(){var e=this.parentNode.parentNode.parentNode.id;$("#"+e+"_controls").removeClass("hidecontrols");var t=document.createElement("div");t.innerHTML=rq_answer_label,$(this).parent().parent().replaceWith(t),allow_student_answers(),delete reading_questions_object[e+"_text"],localStorage.setObject(reading_questions_object_id,reading_questions_object)}),reading_questions_all_answered&&"guest"!=uname&&"student"==role&&make_submit_button(),$("body").on("click","#rq_submit",function(){$("#rq_submit").addClass("submitted"),document.getElementById("rq_submit").textContent="Resubmit answers",save_reading_questions()}),$("body").on("click",".amhelp",function(){var e="Write math formulas as AsciiMath inside `backticks`.\n";e+="For example:\nThe Pythagorean theorem says `sin^2(x) + cos^2(x) = 1`,\n",e+="The quadratic formula is `x = (-b +- sqrt(b^2 - 4ac))/(2a)`. \n",e+="Note the use of parentheses for grouping.\n",e+="Visit http://asciimath.org for a list of AsciiMath commands.\n\n",e+="You can also use LaTeX, with either slash-parentheses \\(...\\)\n",e+="or dollar signs $...$ as delimiters for inline math.",alert(e)}),reading_questions_all_answered&&"guest"!=uname&&"student"==role&&make_submit_button()}