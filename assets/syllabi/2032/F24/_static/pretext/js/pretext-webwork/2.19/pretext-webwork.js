function handleWW(e,t){const n=document.getElementById(e),s=n.dataset.domain,o=n.dataset.problemsource,a=n.dataset.sourcefilepath,r=n.dataset.courseid,c=n.dataset.userid,l=n.dataset.coursepassword,i=(n.dataset.localizeCorrect,n.dataset.localizeIncorrect,n.dataset.localizeBlank,n.dataset.localizeSubmit||"Submit"),d=n.dataset.localizeCheckResponses||"Check Responses",u=n.dataset.localizeReveal||"Reveal",m=n.dataset.localizeRandomize||"Randomize",p=n.dataset.localizeReset||"Reset",h="undefined"!=typeof eBookConfig&&""!==eBookConfig.username,f=document.getElementById(e+"-button");t?"randomize"==t&&(n.dataset.current_seed=Number(n.dataset.current_seed)+100):(n.dataset.current_seed=n.dataset.seed,h&&(n.dataset.current_seed=webworkSeedHash(eBookConfig.username+n.dataset.current_seed)));let y=document.createElement("div");y.style.position="absolute",y.style.left=0,y.style.top=0,y.style.backgroundColor="rgba(0.2, 0.2, 0.2, 0.4)",y.style.color="white",y.style.width="100%",y.style.height="100%",y.style.display="flex",y.style.alignItems="center",y.style.justifyContent="center",y.tabIndex=-1;const b=document.createElement("span");let w;if(b.textContent="Loading",b.style.fontSize="2rem",y.appendChild(b),n.appendChild(y),y.focus(),t||(n.dataset.hasHint=n.getElementsByClassName("hint").length>0,n.dataset.hasSolution=n.getElementsByClassName("solution").length>0,n.dataset.hasAnswer=n.getElementsByClassName("answer").length>0,n.dataset.hintLabelText="true"==n.dataset.hasHint?n.querySelectorAll(".hint-knowl span.type, details.hint span.type")[0].textContent:"Hint",n.dataset.solutionLabelText="true"==n.dataset.hasSolution?n.querySelectorAll(".solution-knowl span.type, details.solution span.type")[0].textContent:"Solution",n.tabIndex=-1),"check"==t){const t=n.querySelector(".problem-iframe"),o=new FormData(t.contentDocument.getElementById(e+"-form")),a=new URLSearchParams(o);w=new URL(s+"/webwork2/render_rpc?"+a.toString()),w.searchParams.append("answersSubmitted","1"),w.searchParams.append("WWsubmit","1")}else w=new URL(s+"/webwork2/render_rpc"),w.searchParams.append("problemSeed",n.dataset.current_seed),o?w.searchParams.append("problemSource",o):a&&w.searchParams.append("sourceFilePath",a),w.searchParams.append("answersSubmitted","0"),w.searchParams.append("displayMode","MathJax"),w.searchParams.append("courseID",r),w.searchParams.append("user",c),w.searchParams.append("passwd",l),w.searchParams.append("disableCookes","1"),w.searchParams.append("outputformat","raw"),w.searchParams.append("showSolutions","true"==n.dataset.hasSolution?"1":"0"),w.searchParams.append("showHints","true"==n.dataset.hasHint?"1":"0"),w.searchParams.append("problemUUID",e);$.getJSON(w.toString(),b=>{const w=document.createElement("form");w.id=e+"-form",w.dataset.iframeHeight=1;const g=document.createElement("div");g.id=e+"-body",g.classList.add("exercise","exercise-like"),g.lang=b.lang,g.dir=b.dir,g.innerHTML=b.rh_result.text;for(const e of["h6","h5","h4","h3","h2","h1"]){const t=g.getElementsByTagName(e);for(heading of t){const e=document.createElement("h6");e.innerHTML=heading.innerHTML,cloneAttributes(e,heading),e.classList.add("webwork-part"),heading.replaceWith(e)}}if(adjustSrcHrefs(g,s),translateHintSol(e,g,s,"true"==n.dataset.hasHint,"true"==n.dataset.hasSolution,n.dataset.hintLabelText,n.dataset.solutionLabelText),h){const t=wwList[e.replace(/-ww-rs$/,"")].answers?wwList[e.replace(/-ww-rs$/,"")].answers:{answers:[],mqAnswers:[]},n=t.mqAnswers;for(const e in n){const t=g.querySelector("input[id="+e+"]");t&&""==t.value&&t.setAttribute("value",n[e])}const s=t.answers;for(const e in s){const t=g.querySelector("input[id="+e+"]");if(t&&""==t.value&&t.setAttribute("value",s[e]),t&&"RADIO"==t.type.toUpperCase()){const t=g.querySelectorAll("input[name="+e+"]");for(const n of t)n.value==s[e]&&n.setAttribute("checked","checked")}if(t&&"CHECKBOX"==t.type.toUpperCase()){const t=g.querySelectorAll("input[name="+e+"]");for(const n of t){let t=new RegExp("(\\[|, )"+n.value+"(, |\\])");s[e].match(t)&&n.setAttribute("checked","checked")}}if(g.querySelector("select[id="+e+"]")&&s[e]){let t=s[e];/^\\text\{.*\}$/.test(t)&&(t=t.match(/^\\text\{(.*)\}$/)[1]);let n=t.replace(/"/g,'\\"');const o=g.querySelector(`select[id="${e}"] option[value="${n}"]`);o&&o.setAttribute("selected","selected")}}}w.appendChild(g);const _={problemSeed:b.inputs_ref.problemSeed,problemUUID:b.inputs_ref.problemUUID,psvn:b.inputs_ref.psvn,courseName:r,courseID:r,user:c,passwd:l,displayMode:"MathJax",session_key:b.rh_result.session_key,outputformat:"raw",language:b.formLanguage,showSummary:b.showSummary,disableCookies:"1",showSolutions:"true"==n.dataset.hasSolution?"1":"0",showHints:"true"==n.dataset.hasHint?"1":"0",forcePortNumber:b.forcePortNumber};a?_.sourceFilePath=a:o&&(_.problemSource=o);for(const e of Object.keys(_)){const t=document.createElement("input");t.type="hidden",t.name=e,t.value=_[e],w.appendChild(t)}const x={};Object.keys(b.rh_result.answers).forEach(function(e){x[e]={}},b.rh_result.answers),"true"==n.dataset.hasAnswer&&Object.keys(b.rh_result.answers).forEach(function(e){x[e]={correct_ans:this[e].correct_ans,correct_ans_latex_string:this[e].correct_ans_latex_string,correct_choice:this[e].correct_choice,correct_choices:this[e].correct_choices}},b.rh_result.answers);let k=n.querySelector(".problem-buttons.webwork");if(k){if("true"==n.dataset.hasAnswer){const t=k.querySelector(".show-correct"),n=t.cloneNode(!0);n.addEventListener("click",()=>WWshowCorrect(e,x)),t.replaceWith(n)}}else{n.querySelector(".problem-buttons").classList.add("hidden-content"),null!=f&&f.classList.add("hidden-content"),k=document.createElement("div"),k.classList.add("problem-buttons","webwork"),null!=f?f.after(k):n.prepend(k);const t=document.createElement("button");t.type="button",t.id=e+"-check",t.style.marginRight="0.25rem",t.classList.add("webwork-button");g.querySelectorAll("input:not([type=hidden])").length,g.querySelectorAll("select:not([type=hidden])").length;if(t.textContent=h?i:d,t.addEventListener("click",()=>handleWW(e,"check")),k.appendChild(t),"true"==n.dataset.hasAnswer){const t=document.createElement("button");t.classList.add("show-correct","webwork-button"),t.type="button",t.style.marginRight="0.25rem",t.textContent=u,t.addEventListener("click",()=>WWshowCorrect(e,x)),k.appendChild(t)}const s=document.createElement("button");s.type="button",s.classList.add("webwork-button"),s.style.marginRight="0.25rem",s.textContent=m,s.addEventListener("click",()=>handleWW(e,"randomize")),k.appendChild(s);const o=document.createElement("button");o.type="button",o.classList.add("webwork-button"),o.textContent=p,o.addEventListener("click",()=>resetWW(e)),k.appendChild(o)}let E='<!DOCTYPE html><head><script src="'+s+"/webwork2_files/node_modules/jquery/dist/jquery.min.js\"></script><script>\n                window.MathJax = {\n                    tex: { packages: { '[+]': ['noerrors'] } },\n                    loader: { load: ['input/asciimath', '[tex]/noerrors'] },\n                    startup: {\n                        ready() {\n                            const AM = MathJax.InputJax.AsciiMath.AM;\n\n                            // Modify existing AsciiMath triggers.\n                            AM.symbols[AM.names.indexOf('**')] = {\n                                input: '**',\n                                tag: 'msup',\n                                output: '^',\n                                tex: null,\n                                ttype: AM.TOKEN.INFIX\n                            };\n\n                            const i = AM.names.indexOf('infty');\n                            AM.names[i] = 'infinity';\n                            AM.symbols[i] = { input: 'infinity', tag: 'mo', output: '\u221e', tex: 'infty', ttype: AM.TOKEN.CONST };\n\n                            return MathJax.startup.defaultReady();\n                        }\n                    },\n                    options: {\n                        renderActions: {\n                            findScript: [\n                                10,\n                                (doc) => {\n                                    for (const node of document.querySelectorAll('script[type^=\"math/tex\"]')) {\n                                        const math = new doc.options.MathItem(\n                                            node.textContent,\n                                            doc.inputJax[0],\n                                            !!node.type.match(/; *mode=display/)\n                                        );\n                                        const text = document.createTextNode('');\n                                        node.parentNode.replaceChild(text, node);\n                                        math.start = { node: text, delim: '', n: 0 };\n                                        math.end = { node: text, delim: '', n: 0 };\n                                        doc.math.push(math);\n                                    }\n                                },\n                                ''\n                            ]\n                        },\n                        ignoreHtmlClass: 'tex2jax_ignore'\n                    }\n                };\n            </script><script src=\""+s+'/webwork2_files/node_modules/mathjax/es5/tex-chtml.js" id="MathJax-script" defer></script><script src="_static/pretext/js/lib/knowl.js" defer></script><link rel="stylesheet" href="'+s+'/webwork2_files/node_modules/bootstrap/dist/css/bootstrap.min.css"/><script src="'+s+'/webwork2_files/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js" defer></script>';const S=[],C=[];b.extra_css_files?b.extra_css_files.unshift(...S):b.extra_css_files=S;for(const e of b.extra_css_files)E+='<link rel="stylesheet" href="'+("1"!==e.external?s:"")+e.file+'"/>';b.extra_js_files?b.extra_js_files.unshift(...C):b.extra_js_files=C;for(const e of b.extra_js_files)E+='<script src="'+("1"!==e.external?s:"")+e.file+'" '+Object.keys(e.attributes||{}).reduce((t,n)=>t+=n+'="'+e.attributes[n]+'" ',"")+"></script>";let v;E+='<link rel="stylesheet" href="_static/pretext/css/pretext_add_on.css"/><link rel="stylesheet" href="_static/pretext/css/knowls_default.css"/><script src="'+s+'/webwork2_files/node_modules/iframe-resizer/js/iframeResizer.contentWindow.min.js"></script><style>\n                html { overflow-y: hidden; }\n                html body { background:unset; margin: 0; }\n                body { font-size: initial; line-height: initial; padding:2px; }\n                .hidden-content { display: none; }\n                span.nobreak { white-space: nowrap; }\n                div.PGML img.image-view-elt { max-width:100%; }\n                .graphtool-answer-container .graphtool-graph { margin: 0; width: 300px; height: 300px; }\n                .graphtool-answer-container .graphtool-number-line { height: 57px; }\n                .quill-toolbar { scrollbar-width: thin; overflow-x: hidden; }\n            </style></head><body><main class="pretext-content problem-content">'+w.outerHTML+"</main></body></html>",t?v=n.querySelector(".problem-iframe"):(v=document.createElement("iframe"),v.style.width="1px",v.style.minWidth="100%",v.classList.add("problem-iframe"),n.querySelector(".problem-contents").classList.add("hidden-content"),null!=f?f.after(v):n.prepend(v),iFrameResize({checkOrigin:!1,scrolling:"omit",heightCalculationMethod:"taggedElement"},v),v.addEventListener("load",()=>{v.contentDocument.getElementById(e+"-form").addEventListener("submit",t=>{handleWW(e,"check"),t.preventDefault()}),v.contentDocument.querySelectorAll(".collapse.in").forEach(e=>e.classList.add("expanded")),v.contentWindow.jQuery(".collapse").on("shown",function(e){e.target==this&&this.classList.add("expanded")}),v.contentWindow.jQuery(".collapse").on("hide",function(e){e.target==this&&this.classList.remove("expanded")}),v.contentWindow.MathJax.startup.promise.then(()=>v.contentWindow.MathJax.typesetPromise([".popover",".popover-content"]))})),v.srcdoc=E,v.addEventListener("load",()=>{y.remove()},{once:!0}),n.focus()})}function WWshowCorrect(e,t){const n=document.getElementById(e).querySelector(".problem-iframe"),s=n.contentDocument.getElementById(e+"-body");$("body").trigger("runestone_show_correct",{ww_id:e,answers:t});let o=s.querySelectorAll("input:not([type=hidden])");for(const s of o){const o=s.name,a=`${e}-${o}-correct`;if("text"==s.type&&t[o]&&!n.contentDocument.getElementById(a)){const e=s.id,r=n.contentDocument.getElementById(`mq-answer-${e}`);r&&(r.style.display="none"),label=n.contentDocument.getElementById(`${a}-label`),label&&(label.parentElement.insertBefore(s,label),label.remove()),s.type="hidden";const c=n.contentDocument.createElement("div");c.innerHTML=t[o].correct_ans,s.value=c.textContent;const l=n.contentDocument.createElement("span");l.id=a,l.appendChild(t[o].correct_ans_latex_string?n.contentDocument.createTextNode("\\("+t[o].correct_ans_latex_string+"\\)"):n.contentDocument.createTextNode(t[o].correct_ans)),s.parentElement.insertBefore(l,s)}if("RADIO"==s.type.toUpperCase()&&t[o]){const e=t[o].correct_choice||t[o].correct_ans;s.value==e?s.checked=!0:s.checked=!1}if("CHECKBOX"==s.type.toUpperCase()&&t[o]){t[o].correct_choices.includes(s.value)?s.checked=!0:s.checked=!1}}const a=s.querySelectorAll("input[type=hidden]");for(const e of a){const s=e.name;if(!e.nextElementSibling)continue;const o=e.nextElementSibling.nextElementSibling;if(o&&t[s]&&o.classList.contains("graphtool-container")){const a=n.contentDocument.createElement("div");e.parentElement.insertBefore(a,o),o.style.display="none",e.value=t[s].correct_ans,n.contentWindow.jQuery(a).html(t[s].correct_ans_latex_string);const r=n.contentDocument.createElement("script");r.textContent=a.querySelector("script").textContent.replace('\nwindow.addEventListener("DOMContentLoaded",',"(").replace(/;\n$/,"();"),n.contentDocument.body.appendChild(r)}}let r=s.querySelectorAll("select:not([type=hidden])");for(const s of r){const o=s.name,a=`${e}-${o}-correct`;if(t[o]&&!n.contentDocument.getElementById(a)){s.style.display="none",s.value=t[o].correct_ans;const e=n.contentDocument.createElement("span");e.id=a,e.appendChild(t[o].correct_ans_latex_string?n.contentDocument.createTextNode("\\("+t[o].correct_ans_latex_string+"\\)"):n.contentDocument.createTextNode(t[o].correct_ans)),s.parentElement.insertBefore(e,s)}}const c=n.contentDocument.createElement("script");c.textContent="MathJax.startup.promise.then(() => MathJax.typesetPromise([document.body]));",n.contentDocument.body.appendChild(c)}function resetWW(e){const t=document.getElementById(e),n=document.getElementById(e+"-button");t.dataset.current_seed=t.dataset.seed,iframe=t.querySelector(".problem-iframe"),iframe.remove(),t.querySelector(".problem-contents").classList.remove("hidden-content"),t.querySelector(".problem-buttons.webwork").remove(),t.querySelector(".problem-buttons").classList.remove("hidden-content"),null!=n&&n.classList.remove("hidden-content")}function adjustSrcHrefs(e,t){e.querySelectorAll("[href]").forEach(e=>{const n=e.attributes.href.value;"#"===n||n.match(/^[a-z]+:\/\//i)||(e.href=t+"/"+n)}),e.querySelectorAll("[data-knowl-url]").forEach(e=>{const n=e.dataset.knowlUrl;"#"===n||n.match(/^[a-z]+:\/\//i)||(e.dataset.knowlUrl=t+n)}),e.querySelectorAll("[src]").forEach(e=>{e.src=new URL(e.attributes.src.value,t).href})}function translateHintSol(e,t,n,s,o,a,r){const c=t.querySelectorAll(".accordion.hint,.accordion.solution");if(0!=c.length)for(const e of c){const t=e.parentNode;solutionlikewrapper=document.createElement("div"),solutionlikewrapper.classList.add("solutions"),t.insertBefore(solutionlikewrapper,e);const c=e.classList.contains("hint")?"hint":"solution";if("solution"==c&&!o||"hint"==c&&!s)continue;const l=e.getElementsByTagName("details")[0];l.className="",l.classList.add(c,"solution-like","born-hidden-knowl"),solutionlikewrapper.appendChild(l);const i=l.getElementsByTagName("summary")[0];i.className="",i.classList.add("knowl__link");i.getElementsByTagName("div")[0].remove();const d=document.createElement("span");d.innerHTML="hint"==c?a:r,i.appendChild(d);const u=document.createElement("span");u.innerHTML=".",i.appendChild(u),adjustSrcHrefs(l,n),e.remove();const m=l.getElementsByTagName("div")[0],p=m.getElementsByTagName("div")[0];p.className="",p.classList.add(c,"solution-like","knowl__content"),l.appendChild(p),m.remove()}}function cloneAttributes(e,t){[...t.attributes].forEach(t=>{e.setAttribute(t.nodeName,t.nodeValue)})}function webworkSeedHash(e){var t,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return Math.abs(n)}